<?xml version="1.0"?>
<!--
Copyright 2009-2024 David Hadka

This file is part of the MOEA Framework.

The MOEA Framework is free software: you can redistribute it and/or modify
it under the terms of the GNU Lesser General Public License as published by 
the Free Software Foundation, either version 3 of the License, or (at your 
option) any later version.

The MOEA Framework is distributed in the hope that it will be useful, but 
WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY 
or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Lesser General Public 
License for more details.

You should have received a copy of the GNU Lesser General Public License 
along with the MOEA Framework.  If not, see <http://www.gnu.org/licenses/>.



Use of these build scripts requires Apache Ant to be installed.  See
<http://ant.apache.org/> for instructions on installing Apache Ant.
-->
<project name="MOEA Framework Macros" basedir="." xmlns:if="ant:if" xmlns:unless="ant:unless">

	<!-- Replace tokens in a given file with their property values -->
	<macrodef name="replace-properties">
		<attribute name="file" />
		
		<sequential>
			<dirname property="replace.dir" file="@{file}" />
		    <tempfile property="temp.file" prefix="filter" suffix=".properties" destDir="${replace.dir}" />
		    <echoproperties destfile="${temp.file}" />
		    <replaceregexp file="${temp.file}" match="([^=]*)=" replace="%\1%=" byline="true" />
			<replace summary="true" file="@{file}" replacefilterfile="${temp.file}" />
			<delete file="${temp.file}" />
		</sequential>
	</macrodef>

	<!-- Securely downloads a URL to a file, validating its checksum -->
	<macrodef name="secure-get">
		<attribute name="src" />
		<attribute name="dest" />
		<attribute name="sha1" />
		
		<sequential>
			<get src="@{src}" dest="@{dest}" />
			<checksum file="@{dest}" property="@{sha1}" algorithm="SHA-1" verifyProperty="checksum.valid"/>
			<delete unless:true="${checksum.valid}" file="@{dest}" />
			<fail unless:true="${checksum.valid}" message="Invalid checksum for @{dest}" />
		</sequential>
	</macrodef>
	
</project>
